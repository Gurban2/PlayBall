# üöÄ –í–Ω–µ–¥—Ä–µ–Ω–∏–µ Riverpod + Real-time Updates

## ‚úÖ –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ

### 1. **–î–æ–±–∞–≤–ª–µ–Ω Riverpod –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º**

```yaml
# pubspec.yaml
dependencies:
  flutter_riverpod: ^2.4.9
```

### 2. **–°–æ–∑–¥–∞–Ω–∞ —Å–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤** (`lib/providers/providers.dart`)

- `authServiceProvider` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- `firestoreServiceProvider` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è —Å–µ—Ä–≤–∏—Å–∞ Firestore
- `currentUserProvider` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è —Ç–µ–∫—É—â–µ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `activeRoomsProvider` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç —Å real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- `plannedRoomsProvider` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç —Å real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏
- `roomProvider` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–æ–º–Ω–∞—Ç—ã
- `userRoomsProvider` - –ø—Ä–æ–≤–∞–π–¥–µ—Ä –¥–ª—è –∫–æ–º–Ω–∞—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 3. **–î–æ–±–∞–≤–ª–µ–Ω—ã Stream –º–µ—Ç–æ–¥—ã –≤ FirestoreService**

```dart
// Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–ª—è –∞–∫—Ç–∏–≤–Ω—ã—Ö –∫–æ–º–Ω–∞—Ç
Stream<List<RoomModel>> getActiveRoomsStream() {
  return _firestore
      .collection('rooms')
      .where('status', isEqualTo: 'active')
      .snapshots()  // üî• –ö–ª—é—á–µ–≤–æ–µ –æ—Ç–ª–∏—á–∏–µ –æ—Ç –æ–±—ã—á–Ω–æ–≥–æ .get()
      .map((snapshot) => snapshot.docs
          .map((doc) => RoomModel.fromMap(doc.data()))
          .toList());
}
```

### 4. **–ü–µ—Ä–µ–ø–∏—Å–∞–Ω HomeScreen –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è Riverpod**

**–ë—ã–ª–æ:**
```dart
class HomeScreen extends StatefulWidget {
  // –ú–Ω–æ–≥–æ –∫–æ–¥–∞ –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º
  UserModel? _currentUser;
  List<RoomModel> _activeRooms = [];
  bool _isLoading = true;
  
  Future<void> _loadData() async {
    // –†—É—á–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
  }
}
```

**–°—Ç–∞–ª–æ:**
```dart
class HomeScreen extends ConsumerStatefulWidget {
  @override
  Widget build(BuildContext context) {
    final activeRoomsAsync = ref.watch(activeRoomsProvider);
    final plannedRoomsAsync = ref.watch(plannedRoomsProvider);
    
    return activeRoomsAsync.when(
      loading: () => CircularProgressIndicator(),
      error: (error, stack) => ErrorWidget(),
      data: (rooms) => ListView(...),
    );
  }
}
```

### 5. **–£–±—Ä–∞–Ω—ã —Ç–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ**

–£–¥–∞–ª–µ–Ω—ã –≤—Å–µ –∑–∞–≥–ª—É—à–∫–∏ –∏–∑ `FirestoreService` - —Ç–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –∏–∑ Firebase.

## üéØ **–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã**

### **–î–æ (–±–µ–∑ Riverpod):**
‚ùå –ö–∞–∂–¥—ã–π —ç–∫—Ä–∞–Ω –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ  
‚ùå –î—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞ –∏ –ª–æ–≥–∏–∫–∏  
‚ùå –ù–µ—Ç —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏  
‚ùå –°–ª–æ–∂–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  
‚ùå –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–µ —ç–∫—Ä–∞–Ω–∞  

### **–ü–æ—Å–ª–µ (—Å Riverpod + Streams):**
‚úÖ **–ï–¥–∏–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –∏—Å—Ç–∏–Ω—ã** - –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –≤ –ø—Ä–æ–≤–∞–π–¥–µ—Ä–∞—Ö  
‚úÖ **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - UI –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö  
‚úÖ **Real-time —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è** - –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤–∏–¥–Ω—ã –º–≥–Ω–æ–≤–µ–Ω–Ω–æ  
‚úÖ **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ** - –¥–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑  
‚úÖ **–ü—Ä–æ—Å—Ç–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è loading/error/data  
‚úÖ **–õ—É—á—à–∞—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –Ω–µ—Ç –ª–∏—à–Ω–∏—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ —Å–µ—Ä–≤–µ—Ä—É  

## üîÑ **–ö–∞–∫ —Ä–∞–±–æ—Ç–∞—é—Ç Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**

### **–°—Ü–µ–Ω–∞—Ä–∏–π –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è:**
1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê** –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∏–≥—Ä –≤ 18:00
2. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ë** —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∏–≥—Ä—É –≤ 18:05
3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ê** –º–≥–Ω–æ–≤–µ–Ω–Ω–æ –≤–∏–¥–∏—Ç –Ω–æ–≤—É—é –∏–≥—Ä—É –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏! üéâ

### **–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏:**
```dart
// –í–º–µ—Å—Ç–æ –æ–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞:
final snapshot = await _firestore.collection('rooms').get();

// –ò—Å–ø–æ–ª—å–∑—É–µ–º –ø–æ—Å—Ç–æ—è–Ω–Ω–æ–µ –ø—Ä–æ—Å–ª—É—à–∏–≤–∞–Ω–∏–µ:
_firestore.collection('rooms').snapshots().listen((snapshot) {
  // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ª—é–±—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö –≤ –∫–æ–ª–ª–µ–∫—Ü–∏–∏
});
```

## üì± **–ß—Ç–æ –∏–∑–º–µ–Ω–∏–ª–æ—Å—å –≤ UI**

### **–ù–æ–≤—ã–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏:**
- **Pull-to-refresh** - –ø–æ—Ç—è–Ω–∏—Ç–µ –≤–Ω–∏–∑ –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫** - –∫—Ä–∞—Å–∏–≤—ã–µ —ç–∫—Ä–∞–Ω—ã –æ—à–∏–±–æ–∫ —Å –∫–Ω–æ–ø–∫–æ–π "–ü–æ–≤—Ç–æ—Ä–∏—Ç—å"
- **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –∑–∞–≥—Ä—É–∑–∫–∏** - –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
- **–ú–≥–Ω–æ–≤–µ–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è** - –Ω–æ–≤—ã–µ –∏–≥—Ä—ã –ø–æ—è–≤–ª—è—é—Ç—Å—è —Å—Ä–∞–∑—É

### **–£–ª—É—á—à–µ–Ω–Ω—ã–π UX:**
- –ù–µ—Ç –∑–∞–¥–µ—Ä–∂–µ–∫ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–∞—Ö –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏
- –î–∞–Ω–Ω—ã–µ –≤—Å–µ–≥–¥–∞ –∞–∫—Ç—É–∞–ª—å–Ω—ã–µ
- –ú–µ–Ω—å—à–µ "–ø—É—Å—Ç—ã—Ö" —ç–∫—Ä–∞–Ω–æ–≤
- –ë–æ–ª–µ–µ –æ—Ç–∑—ã–≤—á–∏–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

## üõ†Ô∏è **–ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –¥—Ä—É–≥–∏—Ö —ç–∫—Ä–∞–Ω–∞—Ö**

### **–ü—Ä–∏–º–µ—Ä –¥–ª—è –Ω–æ–≤–æ–≥–æ —ç–∫—Ä–∞–Ω–∞:**
```dart
class MyScreen extends ConsumerWidget {
  @override
  Widget build(BuildContext context, WidgetRef ref) {
    final user = ref.watch(currentUserProvider);
    final rooms = ref.watch(activeRoomsProvider);
    
    return user.when(
      loading: () => CircularProgressIndicator(),
      error: (error, stack) => Text('–û—à–∏–±–∫–∞: $error'),
      data: (userData) => rooms.when(
        loading: () => CircularProgressIndicator(),
        error: (error, stack) => Text('–û—à–∏–±–∫–∞: $error'),
        data: (roomsData) => YourWidget(userData, roomsData),
      ),
    );
  }
}
```

### **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö:**
```dart
// –ü—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
ref.refresh(activeRoomsProvider);

// –ß—Ç–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –±–µ–∑ –ø–æ–¥–ø–∏—Å–∫–∏
final rooms = ref.read(activeRoomsProvider);
```

### 6. **–û–±–Ω–æ–≤–ª–µ–Ω—ã –≤—Å–µ –æ—Å–Ω–æ–≤–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã**

- ‚úÖ **HomeScreen** - –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Riverpod
- ‚úÖ **ProfileScreen** - –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Riverpod  
- ‚úÖ **RoomScreen** - –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–ø–∏—Å–∞–Ω —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Riverpod
- ‚úÖ **–ö–Ω–æ–ø–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–∞–º –∏ –∞–¥–º–∏–Ω–∞–º

## üîÆ **–°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏**

1. ‚úÖ **–û–±–Ω–æ–≤–∏—Ç—å –æ—Å—Ç–∞–ª—å–Ω—ã–µ —ç–∫—Ä–∞–Ω—ã** (ProfileScreen, RoomScreen, etc.) - **–ì–û–¢–û–í–û!**
2. **–î–æ–±–∞–≤–∏—Ç—å –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã –¥–ª—è –∫–æ–º–∞–Ω–¥ –∏ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π**
3. **–†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –æ–ø—Ç–∏–º–∏—Å—Ç–∏—á–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**
4. **–î–æ–±–∞–≤–∏—Ç—å –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º–∞**

---

**–†–µ–∑—É–ª—å—Ç–∞—Ç:** –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å—Ç–∞–ª–æ –±–æ–ª–µ–µ —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã–º, –±—ã—Å—Ç—Ä—ã–º –∏ –æ—Ç–∑—ã–≤—á–∏–≤—ã–º! üöÄ 