# üîß –†—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É PlayBall

–≠—Ç–æ —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –æ–ø–∏—Å—ã–≤–∞–µ—Ç –ø–æ—à–∞–≥–æ–≤–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö —É–ª—É—á—à–µ–Ω–∏–π –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞ PlayBall.

## üìã –°—Ç–∞—Ç—É—Å —É–ª—É—á—à–µ–Ω–∏–π

### ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

1. **–†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤**
   - ‚úÖ `UserService` - —Ä–∞–±–æ—Ç–∞ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º–∏
   - ‚úÖ `RoomService` - —Ä–∞–±–æ—Ç–∞ —Å –∫–æ–º–Ω–∞—Ç–∞–º–∏
   - ‚è∏Ô∏è –ú–∏–≥—Ä–∞—Ü–∏—è –∏–∑ `firestore_service.dart` (–≤ –ø—Ä–æ—Ü–µ—Å—Å–µ)

2. **–°–∏—Å—Ç–µ–º—ã —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è**
   - ‚úÖ `PermissionsManager` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
   - ‚úÖ `ErrorHandler` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫
   - ‚úÖ `DateFormatter` - –µ–¥–∏–Ω–æ–æ–±—Ä–∞–∑–Ω–æ–µ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç

3. **UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**
   - ‚úÖ `RoomCard` - –ø–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞ –∫–æ–º–Ω–∞—Ç—ã
   - ‚è∏Ô∏è –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–∂–µ—Ç–æ–≤

4. **–ù–∞–≤–∏–≥–∞—Ü–∏—è**
   - ‚úÖ `RouteNames` –∏ `RoutePaths` - —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –º–∞—Ä—à—Ä—É—Ç—ã
   - ‚úÖ `RouteUtils` - —É—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

5. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è**
   - ‚úÖ `ARCHITECTURE.md` - –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
   - ‚úÖ `REFACTORING_GUIDE.md` - —Ä—É–∫–æ–≤–æ–¥—Å—Ç–≤–æ –ø–æ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥—É

### üöß –í –ø—Ä–æ—Ü–µ—Å—Å–µ

1. **–ú–∏–≥—Ä–∞—Ü–∏—è —Å —Å—Ç–∞—Ä—ã—Ö —Å–µ—Ä–≤–∏—Å–æ–≤**
2. **–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –∫—Ä—É–ø–Ω—ã—Ö —ç–∫—Ä–∞–Ω–æ–≤**
3. **–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö –≤–∏–¥–∂–µ—Ç–æ–≤**

### üìã –ü–ª–∞–Ω–∏—Ä—É–µ—Ç—Å—è

1. **–ó–∞–≥—Ä—É–∑–æ—á–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è**
2. **–ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
3. **–£–ª—É—á—à–µ–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –≤ UI**
4. **–õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è**

## üöÄ –ü–æ—à–∞–≥–æ–≤–∞—è –º–∏–≥—Ä–∞—Ü–∏—è

### –≠—Ç–∞–ø 1: –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–µ—Ä–≤–∏—Å–æ–≤ (1-2 –¥–Ω—è)

#### 1.1 –ó–∞–º–µ–Ω–∞ –≤—ã–∑–æ–≤–æ–≤ FirestoreService –Ω–∞ UserService

**–ù–∞–π—Ç–∏ –∏ –∑–∞–º–µ–Ω–∏—Ç—å**:
```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
FirestoreService().getUserById(userId)

// –ù–æ–≤—ã–π –∫–æ–¥  
UserService().getUserById(userId)
```

**–§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:
- `lib/screens/profile_screen.dart`
- `lib/screens/player_profile_screen.dart`
- `lib/providers/user_provider.dart` (–µ—Å–ª–∏ –µ—Å—Ç—å)

#### 1.2 –ó–∞–º–µ–Ω–∞ –≤—ã–∑–æ–≤–æ–≤ –¥–ª—è –∫–æ–º–Ω–∞—Ç

```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
FirestoreService().createRoom(room)
FirestoreService().getRoomById(roomId)

// –ù–æ–≤—ã–π –∫–æ–¥
RoomService().createRoom(room)
RoomService().getRoomById(roomId)
```

**–§–∞–π–ª—ã –¥–ª—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è**:
- `lib/screens/create_room_screen.dart`
- `lib/screens/room_screen.dart`
- `lib/screens/home_screen.dart`

### –≠—Ç–∞–ø 2: –í–Ω–µ–¥—Ä–µ–Ω–∏–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∞–º–∏ (1 –¥–µ–Ω—å)

#### 2.1 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —ç–∫—Ä–∞–Ω–æ–≤ —Å –ø—Ä–æ–≤–µ—Ä–∫–∞–º–∏ –ø—Ä–∞–≤

**–í `room_screen.dart`**:
```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
if (currentUser?.role == UserRole.admin || room.organizerId == currentUser?.id) {
  // –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
}

// –ù–æ–≤—ã–π –∫–æ–¥
if (PermissionsManager.hasPermission(currentUser!, Permission.editRoom, room: room)) {
  // –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
}
```

#### 2.2 –ó–∞–º–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –∫–æ–º–Ω–∞—Ç–µ

```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
if (!room.isFull && !room.players.contains(userId)) {
  // –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è"
}

// –ù–æ–≤—ã–π –∫–æ–¥
if (PermissionsManager.canJoinRoom(currentUser!, room)) {
  // –ø–æ–∫–∞–∑–∞—Ç—å –∫–Ω–æ–ø–∫—É "–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è"
}
```

### –≠—Ç–∞–ø 3: –ó–∞–º–µ–Ω–∞ UI –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (2-3 –¥–Ω—è)

#### 3.1 –ó–∞–º–µ–Ω–∞ –∫–∞—Ä—Ç–æ—á–µ–∫ –∫–æ–º–Ω–∞—Ç

**–í `home_screen.dart` –∏–ª–∏ `schedule_screen.dart`**:
```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
Card(
  child: ListTile(
    title: Text(room.title),
    subtitle: Text(room.location),
    // ... –º–Ω–æ–≥–æ –∫–æ–¥–∞
  ),
)

// –ù–æ–≤—ã–π –∫–æ–¥  
RoomCard(
  room: room,
  currentUser: currentUser,
  onTap: () => context.go(RouteUtils.roomPath(room.id)),
  onJoin: () => _joinRoom(room.id),
  onLeave: () => _leaveRoom(room.id),
)
```

#### 3.2 –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
Navigator.push(
  context,
  MaterialPageRoute(
    builder: (context) => RoomScreen(roomId: roomId),
  ),
);

// –ù–æ–≤—ã–π –∫–æ–¥
context.go(RouteUtils.roomPath(roomId));
```

### –≠—Ç–∞–ø 4: –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ (1 –¥–µ–Ω—å)

#### 4.1 –ó–∞–º–µ–Ω–∞ try-catch –±–ª–æ–∫–æ–≤

```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
try {
  await FirestoreService().createRoom(room);
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text('–ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞')),
  );
} catch (e) {
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text('–û—à–∏–±–∫–∞: $e')),
  );
}

// –ù–æ–≤—ã–π –∫–æ–¥
try {
  await RoomService().createRoom(room);
  ScaffoldMessenger.of(context).showSnackBar(
    SnackBar(content: Text('–ö–æ–º–Ω–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∞')),
  );
} catch (e) {
  final appError = ErrorHandler.handleError(e);
  ErrorHandler.showErrorSnackBar(context, appError);
}
```

#### 4.2 –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–∞–ª–∏–¥–∞—Ü–∏–∏

```dart
// –í —Ñ–æ—Ä–º–∞—Ö —Å–æ–∑–¥–∞–Ω–∏—è –∫–æ–º–Ω–∞—Ç—ã
final titleError = ErrorHandler.validateRoomTitle(titleController.text);
if (titleError != null) {
  ErrorHandler.showErrorSnackBar(context, titleError);
  return;
}
```

### –≠—Ç–∞–ø 5: –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞—Ç (0.5 –¥–Ω—è)

```dart
// –°—Ç–∞—Ä—ã–π –∫–æ–¥
Text('${room.startTime.day}.${room.startTime.month}.${room.startTime.year}')

// –ù–æ–≤—ã–π –∫–æ–¥
Text(DateFormatter.formatDisplayDate(room.startTime))
```

## üõ†Ô∏è –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –º–∏–≥—Ä–∞—Ü–∏–∏

### –°–∫—Ä–∏–ø—Ç –ø–æ–∏—Å–∫–∞ –∏ –∑–∞–º–µ–Ω—ã

–°–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª `migrate.sh`:

```bash
#!/bin/bash

# –ó–∞–º–µ–Ω–∞ FirestoreService –Ω–∞ —Å–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å—ã
find lib -name "*.dart" -exec sed -i 's/FirestoreService().getUserById/UserService().getUserById/g' {} \;
find lib -name "*.dart" -exec sed -i 's/FirestoreService().createRoom/RoomService().createRoom/g' {} \;
find lib -name "*.dart" -exec sed -i 's/FirestoreService().getRoomById/RoomService().getRoomById/g' {} \;

echo "–ú–∏–≥—Ä–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤—Ä—É—á–Ω—É—é."
```

### VS Code —Å–Ω–∏–ø–ø–µ—Ç—ã

–î–æ–±–∞–≤—å—Ç–µ –≤ `.vscode/snippets/dart.json`:

```json
{
  "Permission Check": {
    "prefix": "perm",
    "body": [
      "if (PermissionsManager.hasPermission(${1:user}, Permission.${2:action}, room: ${3:room})) {",
      "  ${4:// –†–∞–∑—Ä–µ—à–µ–Ω–Ω–æ–µ –¥–µ–π—Å—Ç–≤–∏–µ}",
      "}"
    ],
    "description": "–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞"
  },
  "Error Handler": {
    "prefix": "errorhandle",
    "body": [
      "try {",
      "  ${1:// –ö–æ–¥ –∫–æ—Ç–æ—Ä—ã–π –º–æ–∂–µ—Ç –≤—ã–∑–≤–∞—Ç—å –æ—à–∏–±–∫—É}",
      "} catch (e) {",
      "  final appError = ErrorHandler.handleError(e);",
      "  ErrorHandler.showErrorSnackBar(context, appError);",
      "}"
    ],
    "description": "–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"
  }
}
```

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏

### –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤

```bash
# Unit —Ç–µ—Å—Ç—ã
flutter test test/unit/

# Widget —Ç–µ—Å—Ç—ã (–º–æ–≥—É—Ç –ø–∞–¥–∞—Ç—å –¥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è)
flutter test test/widget/

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞
flutter analyze
```

### –ß–µ–∫-–ª–∏—Å—Ç –ø—Ä–æ–≤–µ—Ä–∫–∏

- [ ] –í—Å–µ unit —Ç–µ—Å—Ç—ã –ø—Ä–æ—Ö–æ–¥—è—Ç
- [ ] –ù–µ—Ç –æ—à–∏–±–æ–∫ –∞–Ω–∞–ª–∏–∑–∞ –∫–æ–¥–∞
- [ ] –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –±–µ–∑ –∫—Ä–∞—à–µ–π
- [ ] –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Ä–∞–±–æ—Ç–∞—é—Ç:
  - [ ] –í—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É
  - [ ] –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–Ω–∞—Ç—ã
  - [ ] –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ –∫–æ–º–Ω–∞—Ç–µ
  - [ ] –ü—Ä–æ—Å–º–æ—Ç—Ä –ø—Ä–æ—Ñ–∏–ª—è
  - [ ] –ù–∞–≤–∏–≥–∞—Ü–∏—è –º–µ–∂–¥—É —ç–∫—Ä–∞–Ω–∞–º–∏

## üîç –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–æ—Å–ª–µ –≤–Ω–µ–¥—Ä–µ–Ω–∏—è

### –ú–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

1. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å**
   - –í—Ä–µ–º—è –∑–∞–≥—Ä—É–∑–∫–∏ —ç–∫—Ä–∞–Ω–æ–≤
   - –†–∞–∑–º–µ—Ä –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –ø–∞–º—è—Ç–∏

2. **–ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫ –∫–æ–¥–∞ –≤ —Ñ–∞–π–ª–∞—Ö
   - –°–ª–æ–∂–Ω–æ—Å—Ç—å –º–µ—Ç–æ–¥–æ–≤
   - –ü–æ–∫—Ä—ã—Ç–∏–µ —Ç–µ—Å—Ç–∞–º–∏

3. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç**
   - –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—à–∏–±–æ–∫
   - –í—Ä–µ–º—è –æ—Ç–∫–ª–∏–∫–∞ UI
   - –£–¥–æ–±—Å—Ç–≤–æ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã

```bash
# –ê–Ω–∞–ª–∏–∑ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤
find lib -name "*.dart" -exec wc -l {} + | sort -nr | head -20

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
flutter deps

# –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å
flutter build apk --analyze-size
```

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [ARCHITECTURE.md](ARCHITECTURE.md) - –ø–æ–¥—Ä–æ–±–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
- [Flutter Best Practices](https://flutter.dev/docs/development/ui/layout/best-practices)
- [Riverpod Documentation](https://riverpod.dev/)
- [GoRouter Documentation](https://pub.dev/packages/go_router)

## üÜò –ü–æ–ª—É—á–µ–Ω–∏–µ –ø–æ–º–æ—â–∏

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
2. –£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ –≤—Å–µ –∏–º–ø–æ—Ä—Ç—ã –æ–±–Ω–æ–≤–ª–µ–Ω—ã
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ –Ω–æ–≤—ã–µ —Ñ–∞–π–ª—ã –¥–æ–±–∞–≤–ª–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç
4. –û–±—Ä–∞—Ç–∏—Ç–µ—Å—å –∫ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã

---

*–ü–æ—Å–ª–µ–¥–Ω–µ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ: –î–µ–∫–∞–±—Ä—å 2024* 